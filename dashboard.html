<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        // 1. DEFINITION: What counts as "Admin"?
        // If we are on Localhost OR if URL has '?mode=admin'
        const isLocal = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";
        const isAdmin = window.location.search.includes('mode=admin');

        // 2. LOGIC: Only run Google Analytics if we are NOT Admin
        if (!isLocal && !isAdmin) {

            // Dynamically inject the Google Script
            var script = document.createElement('script');
            script.async = true;
            // ⚠️ REPLACE 'G-XXXXXXXXXX' BELOW WITH YOUR ACTUAL ID ⚠️
            script.src = "https://www.googletagmanager.com/gtag/js?id=G-G-C3G5XJ21L2";
            document.head.appendChild(script);

            // Initialize Google Analytics
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            // ⚠️ REPLACE 'G-XXXXXXXXXX' BELOW WITH YOUR ACTUAL ID ⚠️
            gtag('config', 'G-G-C3G5XJ21L2');

            console.log("Analytics: Tracking Enabled");
        } else {
            console.log("Analytics: Admin/Localhost detected - Tracking Disabled");
        }
    </script>
    <title>Live Market Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #0f172a;
            /* Dark Slate */
            color: #e2e8f0;
            font-family: 'Segoe UI', sans-serif;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Card Hover Effect */
        .card {
            transition: all 0.2s ease;
            border: 1px solid #1e293b;
        }

        .card:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body class="p-6 md:p-12 min-h-screen">

    <div class="max-w-5xl mx-auto mb-12 flex justify-between items-end border-b border-slate-700 pb-6">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight">Market<span class="text-blue-500">_Terminal</span>
            </h1>
            <p class="text-slate-400 text-sm mt-1">Live Feed • CoinGecko API v3</p>
        </div>
        <div class="flex gap-4">
            <a href="index.html" class="text-slate-400 hover:text-white text-sm py-2">← Back to Portfolio</a>
            <button onclick="fetchPrices()"
                class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold px-5 py-2 rounded transition-colors shadow-lg shadow-blue-900/20">
                REFRESH DATA
            </button>
        </div>
    </div>

    <div id="status-bar" class="max-w-5xl mx-auto mb-6 text-xs text-slate-500 font-mono">
        STATUS: WAITING FOR DATA...
    </div>

    <div id="card-container" class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    </div>

    <script>
        const container = document.getElementById("card-container");
        const status = document.getElementById("status-bar");

        // The API Endpoint (Top 6 coins, USD)
        const API_URL = "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=6&page=1&sparkline=false";

        async function fetchPrices() {
            try {
                // 1. Loading State
                status.innerText = "STATUS: FETCHING DATA...";
                status.classList.add("animate-pulse", "text-blue-400");

                // 2. Fetch Data
                const response = await fetch(API_URL);

                // 3. Handle Errors (e.g., API Limit)
                if (!response.ok) throw new Error("API Limit Reached or Network Error");

                const data = await response.json();

                // 4. Render
                renderCards(data);

                // 5. Success State
                status.innerText = `STATUS: DATA UPDATED AT ${new Date().toLocaleTimeString()}`;
                status.classList.remove("animate-pulse", "text-blue-400");
                status.classList.add("text-green-500");

            } catch (error) {
                status.innerText = `ERROR: ${error.message}`;
                status.classList.add("text-red-500");
                container.innerHTML = `<div class="col-span-3 text-center text-red-400 py-10">Failed to load data. API might be busy. Try again in 1 minute.</div>`;
            }
        }

        function renderCards(coins) {
            container.innerHTML = ""; // Clear old data

            coins.forEach(coin => {
                // Determine color for price change (Green for up, Red for down)
                const isPositive = coin.price_change_percentage_24h >= 0;
                const colorClass = isPositive ? "text-green-400" : "text-red-400";
                const arrow = isPositive ? "▲" : "▼";

                // Create Card HTML
                const card = `
                    <div class="card bg-slate-800 p-6 rounded-lg cursor-default">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <img src="${coin.image}" alt="${coin.name}" class="w-8 h-8 rounded-full">
                                <div>
                                    <h3 class="text-white font-bold text-lg leading-none">${coin.name}</h3>
                                    <span class="text-slate-500 text-xs uppercase font-bold tracking-wider">${coin.symbol}</span>
                                </div>
                            </div>
                            <span class="mono text-xs text-slate-500">RANK #${coin.market_cap_rank}</span>
                        </div>
                        
                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-slate-400 text-xs mb-1">Current Price</p>
                                <p class="text-2xl text-white font-bold mono">$${coin.current_price.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-slate-400 text-xs mb-1">24h Change</p>
                                <p class="${colorClass} font-bold mono text-sm">
                                    ${arrow} ${coin.price_change_percentage_24h.toFixed(2)}%
                                </p>
                            </div>
                        </div>
                    </div>
                `;

                // Inject into container
                container.innerHTML += card;
            });
        }

        // Auto-fetch on load
        fetchPrices();
    </script>
</body>

</html>